---
title: "Relationship between Microbiome and Food"
output:
  workflowr::wflow_html:
    toc: true
editor_options:
  chunk_output_type: console
---

This page contains the investigation of the changes over time.

```{r data, include=FALSE, echo=FALSE}

# load packages
source("code/load_packages.R")

# get data
source("code/get_cleaned_data.R")

theme_set(theme_bw())
pal = "Set1"
scale_colour_discrete <-  function(palname=pal, ...){
  scale_colour_brewer(palette=palname, ...)
}
scale_fill_discrete <-  function(palname=pal, ...){
  scale_fill_brewer(palette=palname, ...)
}

knitr::opts_chunk$set(out.width = "225%")

```


# Data prep

This is only to recode some variables to ease interpretation.

```{r}

microbiome_data$meta.dat <- microbiome_data$meta.dat %>%
  mutate(intB = ifelse(Intervention=="B", 1,0),
         time = as.numeric(Week) - 1,
         female = ifelse(Gender == "F", 1, 0),
         hispanic = ifelse(Ethnicity %in% c("White", "Asian", "Native America"), 1, 0))

```


# Phylum Level Microbiome and Food

Get the phylum level data

```{r}

data.phylum <-get_combined_data(mydata=microbiome_data,
                                taxa.level="Phylum")

#phylum 
bugs <- data.phylum$bug.list
bugs
```

## Correlation between Phylum and HEI scores

### Start of Study

#### Actinobacteria

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[1])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[1]))

```

#### Bacteroidetes

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[2])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[2]))

```

#### Cyanobacteria

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[3])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[3]))

```

#### Euryarchaeota

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[4])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[4]))

```

#### Firmicutes

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[5])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[5]))

```

#### Fusobacteria

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[6])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[6]))

```

#### Lentisphaerae

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[7])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[7]))

```

#### Proteobacteria

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[8])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[8]))

```

#### Tenericutes

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[9])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[9]))

```

#### Verrucomicrobia

```{r}

subdat <- filter(data.phylum$full_data,
                 Week == "1" & Bug == bugs[10])

ggplot(subdat, aes(x=Abundance, y=HEI_Total,
                   color=Intervention))+
  geom_point(size=3) +
  labs(title = paste0("Phylum: ", bugs[10]))

```
